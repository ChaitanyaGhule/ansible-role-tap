---
# defaults file for TAP deployment
# Production configuration variables for multi-market deployment
# All markets for production deployment
tap_markets:
  - pl
  - gr
  - at
  - cz
  - pt
  - be
  - es
  - fr
  - it
  - ch
  - ro
  - il
  - nord
  - uk
  - nl
  - tr

# Default version
tap_version: "20240724"

# Default translation file
tap_translation_file: "translations.json"

# Optimized Node.js options for 16 markets deployment
tap_node_options: "--max_old_space_size=4096"

# Performance optimization
tap_async_timeout: 1800  # Reserved for future parallel implementation
tap_parallel_limit: 4    # Reserved for future parallel implementation
tap_deployment_strategy: "sequential"  # Currently sequential
tap_batch_size: 4        # Reserved for future parallel implementation
tap_enable_parallel: false  # Currently disabled

# Git repository configuration (working SSH configuration)
git_repo_url: "ssh://git@52.166.71.39:7999/ans/ansible-role-tap.git"
git_branch: "master"
git_clone_path: "/tmp/ansible-role-tap"

# Repository URLs for configure.yml compatibility
tap_backend_repo_url: "ssh://git@52.166.71.39:7999/ans/ansible-role-tap.git"
tap_frontend_repo_url: "ssh://git@52.166.71.39:7999/ans/ansible-role-tap.git"
tap_git_branch: "master"

# Source paths - Use git pull directly, disable fallback copy
# tap_backend_source_path: "/tmp/ansible-role-tap_backend/nespresso-test/new_infra_tap_source/back/nespresso_ev2-server-rc-mobile_php81"
# tap_frontend_source_path: "/tmp/ansible-role-tap_frontend/nespresso-test/new_infra_tap_source/front/nespresso_ev2-client-master"

# production deployment paths (static for sequential execution)
tap_backend_clone_path: "/tmp/ansible-role-tap_backend"
tap_frontend_clone_path: "/tmp/ansible-role-tap_frontend"

# CRITICAL FIX: Use persistent /opt paths instead of temporary /mnt
# OLD RISKY PATHS: /mnt/v2-markets and /mnt/www (temporary storage)
# NEW SAFE PATHS: /opt/tap/* (persistent storage)
tap_backend_base_path: "/opt/tap/v2-markets"
tap_frontend_base_path: "/opt/tap/www"

# Derived paths for each market (using variables for maintainability)
tap_backend_path: "{{ tap_backend_base_path }}/prod_{{ market }}/server/production"
tap_frontend_path: "{{ tap_frontend_base_path }}/prod_{{ market }}/nespresso_ev2-client"

# Cache directories (keep in /tmp as they are meant to be temporary)
tap_composer_cache_dir: "/tmp/composer-cache"
tap_npm_cache_dir: "/tmp/npm-cache"

# File ownership configuration
tap_file_owner: "apache"
tap_file_group: "apache"

# Force fresh deployment
tap_force_fresh_deployment: true
tap_cleanup_old_deployments: true
tap_aggressive_cleanup: true
tap_cleanup_temp_files: true

# Translation sync configuration
tap_translation_sync_enabled: true
tap_translation_import_enabled: false

# production deployment configuration
tap_git_pull_enabled: true
tap_git_stash_enabled: true
tap_verify_source_exists: true
tap_fail_on_missing_source: true

# NPM configuration
tap_use_npm_install: true
tap_npm_cache_enabled: true
tap_npm_production_build: true

# Composer configuration - Production Safety
tap_composer_install_enabled: true
tap_composer_optimize_autoloader: true
tap_composer_no_dev: true
tap_composer_no_scripts: true
tap_composer_no_interaction: true
tap_composer_prefer_dist: true
tap_composer_cache_enabled: true
tap_composer_skip_update: true  # Skip update in production
tap_composer_force_update: false  # Set to true only if dependencies must be updated
tap_composer_apcu_autoloader: true
tap_require_composer_lock: false  # SAFETY: Disabled for deployment without composer.lock
tap_backup_vendor: true  # Backup vendor directory before changes
